@model IEnumerable<BlogEcommerce.Models.Order>

@{
    ViewData["Title"] = "Manage Orders";
    // دالة مساعدة للحصول على لون Badge بناءً على الحالة
    string GetStatusClass(string status) => status switch
    {
        "Pending" => "bg-warning-custom text-dark",
        "Processing" => "bg-primary-accent",
        "Shipped" => "bg-info-accent",
        "Completed" => "bg-success-accent",
        "Cancelled" => "bg-danger-custom",
        _ => "bg-secondary-monochrome"
    };

    // دالة مساعدة للحصول على لون الزر بناءً على الحالة
    string GetFilterButtonClass(string status)
    {
        var currentStatus = ViewBag.CurrentStatus as string;
        var baseClass = "btn-monochrome-filter";
        if (currentStatus == status) return $"btn {status}-active-accent";

        return status switch
        {
            "Pending" => $"btn {baseClass} btn-outline-warning-custom",
            "Completed" => $"btn {baseClass} btn-outline-success-accent",
            "Cancelled" => $"btn {baseClass} btn-outline-danger-custom",
            _ => $"btn {baseClass} btn-outline-dark-custom"
        };
    }
}

<div class="container-xl py-5">

    <div class="d-flex justify-content-between align-items-center mb-5 border-bottom pb-3">
        <h1 class="page-title fw-bold"><i class="fas fa-clipboard-list me-2"></i> Order Management</h1>
        <form asp-action="UpdateAllOrderStatuses" method="post" class="d-inline">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-info-accent btn-lg update-all-btn">
                <i class="fas fa-sync-alt me-2"></i> Update Order Statuses
            </button>
        </form>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
            <div class="alert alert-success-custom alert-dismissible fade show mb-4" role="alert">
                <i class="fas fa-check-circle me-2"></i> @TempData["SuccessMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
    }

    <div class="card filter-card mb-4 shadow-sm">
        <div class="card-body">
            <h6 class="fw-bold mb-3 text-primary-text">Filter by Status:</h6>
            <div class="btn-group filter-group" role="group">

                <a asp-action="Orders" class="@(string.IsNullOrEmpty(ViewBag.CurrentStatus) ? "btn btn-primary-accent active-filter" : "btn btn-outline-dark-custom")">
                    All Orders (@Model.Count())
                </a>

                <a asp-action="Orders" asp-route-status="Pending" class="@(ViewBag.CurrentStatus == "Pending" ? "btn bg-warning-custom active-filter" : "btn btn-outline-warning-custom")">
                    Pending (@Model.Count(o => o.Status == "Pending"))
                </a>

                <a asp-action="Orders" asp-route-status="Processing" class="@(ViewBag.CurrentStatus == "Processing" ? "btn btn-primary-accent active-filter" : "btn btn-outline-primary-accent")">
                    Processing (@Model.Count(o => o.Status == "Processing"))
                </a>

                <a asp-action="Orders" asp-route-status="Shipped" class="@(ViewBag.CurrentStatus == "Shipped" ? "btn btn-info-accent active-filter" : "btn btn-outline-info-accent")">
                    Shipped (@Model.Count(o => o.Status == "Shipped"))
                </a>

                <a asp-action="Orders" asp-route-status="Completed" class="@(ViewBag.CurrentStatus == "Completed" ? "btn bg-success-accent active-filter" : "btn btn-outline-success-accent")">
                    Completed (@Model.Count(o => o.Status == "Completed"))
                </a>

                <a asp-action="Orders" asp-route-status="Cancelled" class="@(ViewBag.CurrentStatus == "Cancelled" ? "btn bg-danger-custom active-filter" : "btn btn-outline-danger-custom")">
                    Cancelled (@Model.Count(o => o.Status == "Cancelled"))
                </a>
            </div>
        </div>
    </div>

    <div class="card orders-table-card shadow-sm">
        <div class="card-body p-0">
            @if (Model.Any())
            {
                    <div class="table-responsive">
                        <table class="table table-monochrome table-hover orders-table mb-0">
                            <thead>
                                <tr class="table-header-monochrome">
                                    <th>Order #</th>
                                    <th>Customer Name</th>
                                    <th>Order Date</th>
                                    <th>Items</th>
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                            @foreach (var order in Model)
                            {
                                    <tr>
                                        <td><strong class="text-primary-link">#@order.Id</strong></td>
                                        <td>@order.CustomerName</td>
                                        <td>@order.OrderDate.ToString("MMM dd, yyyy HH:mm")</td>
                                        <td>@order.OrderItems.Count() items</td>
                                        <td><strong class="text-error-accent">$@order.TotalAmount.ToString("N2")</strong></td>
                                        <td>
                                            <span class="badge rounded-pill @GetStatusClass(order.Status) text-white p-2">
                                            @order.Status
                                            </span>
                                        </td>
                                        <td>
                                            <a asp-action="OrderDetails" asp-route-id="@order.Id" class="btn btn-sm btn-outline-dark-custom">
                                                <i class="fas fa-eye me-1"></i> Details
                                            </a>
                                        </td>
                                    </tr>
                            }
                            </tbody>
                        </table>
                    </div>
            }
            else
            {
                    <div class="text-center py-5">
                        <h4 class="fw-bold text-primary-text">No orders found</h4>
                        <p class="text-secondary mt-3">
                        @if (!string.IsNullOrEmpty(ViewBag.CurrentStatus))
                        {
                            <text>There are currently no orders with status "@ViewBag.CurrentStatus".</text>
                        }
                        else
                        {
                            <text>No orders have been placed yet.</text>
                        }
                        </p>
                        <a asp-action="Orders" class="btn btn-outline-dark-custom mt-3">View All Orders</a>
                    </div>
            }
        </div>
    </div>
</div>