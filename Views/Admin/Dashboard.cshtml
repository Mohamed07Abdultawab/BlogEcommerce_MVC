@* Admin Dashboard *@
@{
    ViewData["Title"] = "Admin Dashboard";
}

<div class="container-xl py-5">
    
    <div class="d-flex justify-content-between align-items-center mb-5 border-bottom pb-3">
        <h1 class="page-title fw-bold">Dashboard Overview</h1>
        <a asp-action="Statistics" class="btn btn-primary-accent btn-lg">
            <i class="fas fa-chart-line me-2"></i> View Detailed Statistics
        </a>
    </div>

    <div class="row mb-5 g-4">
        
        <div class="col-md-6 col-lg-3">
            <div class="card stat-card bg-custom-dark text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase mb-1 small-title">Total Products</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TotalProducts</h2>
                        </div>
                        <div class="fs-1 text-accent-blue"><i class="fas fa-box"></i></div>
                    </div>
                </div>
                 <a asp-controller="Products" asp-action="Index" class="card-footer-link text-white text-decoration-none p-2 ps-3">
                    <small>View All <i class="fas fa-arrow-right ms-1"></i></small>
                </a>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card stat-card bg-success-accent text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase mb-1 small-title">Blog Posts</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TotalBlogPosts</h2>
                        </div>
                        <div class="fs-1"><i class="fas fa-blog"></i></div>
                    </div>
                </div>
                 <a asp-controller="Blog" asp-action="Index" class="card-footer-link text-white text-decoration-none p-2 ps-3">
                    <small>View All <i class="fas fa-arrow-right ms-1"></i></small>
                </a>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card stat-card bg-warning-custom text-dark h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase mb-1 small-title">Total Orders</h6>
                            <h2 class="mb-0 fw-bold">@ViewBag.TotalOrders</h2>
                        </div>
                        <div class="fs-1"><i class="fas fa-shopping-cart"></i></div>
                    </div>
                </div>
                 <a asp-action="Orders" class="card-footer-link text-dark text-decoration-none p-2 ps-3">
                    <small>View All <i class="fas fa-arrow-right ms-1"></i></small>
                </a>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card stat-card bg-primary-accent text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title text-uppercase mb-1 small-title">Total Revenue</h6>
                            <h2 class="mb-0 fw-bold">$@ViewBag.TotalRevenue.ToString("N2")</h2>
                        </div>
                        <div class="fs-1"><i class="fas fa-hand-holding-usd"></i></div>
                    </div>
                    <small class="text-white small-title">All completed orders</small>
                </div>
            </div>
        </div>
    </div>

    @if (ViewBag.PendingOrders > 0)
    {
        <div class="alert alert-warning-custom-light alert-dismissible fade show mb-4" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Attention!</strong> You have <span class="fw-bold">@ViewBag.PendingOrders</span> pending order(s) to process.
            <a asp-action="Orders" asp-route-status="Pending" class="alert-link fw-bold text-dark-link ms-2">View Pending Orders</a>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row g-4">
        
        <div class="col-lg-8">
            
            <div class="card dashboard-card mb-4">
                <div class="card-header bg-gray-light d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 fw-bold text-primary-text">Recent Orders</h5>
                    <a asp-action="Orders" class="btn btn-sm btn-outline-secondary">View All</a>
                </div>
                <div class="card-body p-0">
                    @if (ViewBag.RecentOrders != null && ((List<BlogEcommerce.Models.Order>)ViewBag.RecentOrders).Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-monochrome mb-0">
                                <thead>
                                    <tr class="table-header-monochrome">
                                        <th>Order #</th>
                                        <th>Customer</th>
                                        <th>Date</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var order in (List<BlogEcommerce.Models.Order>)ViewBag.RecentOrders)
                                {
                                    <tr>
                                        <td><a href="#" class="text-primary-link fw-bold">#@order.Id</a></td>
                                        <td>@order.CustomerName</td>
                                        <td>@order.OrderDate.ToString("MMM dd, yyyy")</td>
                                        <td><span class="text-error-accent fw-bold">$@order.TotalAmount.ToString("N2")</span></td>
                                        <td>
                                            @* Mapping Status to our accent colors *@
                                            @{
                                                var statusClass = order.Status == "Pending" ? "bg-warning-custom" : 
                                                                    order.Status == "Completed" ? "bg-success-accent" : 
                                                                    order.Status == "Shipped" ? "bg-primary-accent" : 
                                                                    "bg-gray-light text-primary";
                                            }
                                            <span class="badge rounded-pill @statusClass text-white">@order.Status</span>
                                        </td>
                                        <td>
                                            <a asp-action="OrderDetails" asp-route-id="@order.Id" class="btn btn-sm btn-outline-dark-custom">View</a>
                                        </td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted text-center py-3">No recent orders to display.</p>
                    }
                </div>
            </div>

            <div class="card dashboard-card mb-4">
                <div class="card-header bg-danger-custom-light text-danger-accent">
                    <h5 class="mb-0 fw-bold">⚠️ Low Stock Alert</h5>
                </div>
                <div class="card-body p-0">
                    @if (ViewBag.LowStockProducts != null && ((List<BlogEcommerce.Models.Product>)ViewBag.LowStockProducts).Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-monochrome mb-0">
                                <thead>
                                    <tr class="table-header-monochrome">
                                        <th>Product</th>
                                        <th>Category</th>
                                        <th>Stock</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                @foreach (var product in (List<BlogEcommerce.Models.Product>)ViewBag.LowStockProducts)
                                {
                                    <tr>
                                        <td>@product.Name</td>
                                        <td>@product.Category</td>
                                        <td>
                                            <span class="badge rounded-pill bg-danger-custom text-white">@product.Stock left</span>
                                        </td>
                                        <td>
                                            <a asp-controller="Products" asp-action="Edit" asp-route-id="@product.Id" class="btn btn-sm btn-warning-custom">Update Stock</a>
                                        </td>
                                    </tr>
                                }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-success-accent fw-bold text-center py-3">✓ All products have sufficient stock!</p>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            
            <div class="card dashboard-card mb-4 sticky-top-custom">
                <div class="card-header bg-gray-light">
                    <h5 class="mb-0 fw-bold text-primary-text"><i class="fas fa-bolt me-2"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-3">
                       <a asp-controller="Products" asp-action="Create" class="btn btn-primary-accent btn-lg">
                        <i class="fas fa-plus me-2"></i> Add New Product
                    </a>

                    <a asp-controller="Blog" asp-action="Create" class="btn btn-success-accent btn-lg">
                        <i class="fas fa-plus me-2"></i> Create Blog Post
                    </a>

                    <a asp-action="Orders" asp-route-status="Pending" class="btn btn-warning-custom btn-lg text-dark">
                        <i class="fas fa-clipboard-list me-2"></i> View Pending Orders (@ViewBag.PendingOrders)
                    </a>

                    <a asp-action="AllCarts" class="btn btn-info-accent btn-lg">
                        <i class="fas fa-shopping-cart me-2"></i> View All User Carts
                    </a>

                    <a asp-action="Statistics" class="btn btn-primary-accent btn-lg">
                        <i class="fas fa-chart-line me-2"></i> View Statistics
                    </a>
                    </div>
                </div>
            </div>

            <div class="card dashboard-card mb-4">
                <div class="card-header bg-gray-light">
                    <h5 class="mb-0 fw-bold text-primary-text">Recent Blog Posts</h5>
                </div>
                <div class="card-body p-0">
                    @if (ViewBag.RecentPosts != null && ((List<BlogEcommerce.Models.BlogPost>)ViewBag.RecentPosts).Any())
                    {
                        <ul class="list-group list-group-flush list-group-monochrome">
                        @foreach (var post in (List<BlogEcommerce.Models.BlogPost>)ViewBag.RecentPosts)
                        {
                            <li class="list-group-item px-3 py-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="flex-grow-1">
                                        <a asp-controller="Blog" asp-action="Details" asp-route-id="@post.Id" class="text-primary-link fw-bold">@post.Title</a>
                                        <br /><small class="text-muted">@post.CreatedDate.ToString("MMM dd, yyyy")</small>
                                    </div>
                                    <a asp-controller="Blog" asp-action="Edit" asp-route-id="@post.Id" class="btn btn-sm btn-outline-dark-custom ms-2">Edit</a>
                                </div>
                            </li>
                        }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted text-center py-3">No blog posts yet.</p>
                    }
                </div>
            </div>

            <div class="card dashboard-card">
                <div class="card-header bg-custom-dark text-white">
                    <h5 class="mb-0 fw-bold"><i class="fas fa-cogs me-2"></i> System Information</h5>
                </div>
                <div class="card-body small p-3">
                    <p class="mb-1"><strong>Server Time:</strong> @DateTime.Now.ToString("MMM dd, yyyy HH:mm")</p>
                    <p class="mb-1"><strong>Database:</strong> <span class="text-success-accent fw-bold">Connected</span></p>
                    <p class="mb-0"><strong>Version:</strong> 1.0.0</p>
                </div>
            </div>
        </div>
    </div>
</div>